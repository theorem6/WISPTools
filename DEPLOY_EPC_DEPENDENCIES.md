# Deploy EPC Dependency Fixes

This document explains how to deploy the EPC dependency fixes (cmake, flex, bison) to both GCE backend and Firebase.

## Backend Deployment to GCE

The updated files need to be deployed to the GCE server at `136.112.111.167`:

### Files Updated:
1. `gce-backend/routes/epc-deployment.js` - Added `cmake` to preseed package list
2. `gce-backend/utils/deployment-helpers.js` - Added `cmake flex bison` to deployment script dependencies
3. `backend-services/routes/epc-deployment.js` - Added `cmake flex bison` to preseed package list

### Deployment Steps:

**Option 1: SSH into GCE server and run:**

```bash
ssh root@136.112.111.167

# Once connected, run:
cd /root/lte-pci-mapper
git pull origin main

# Copy updated files
mkdir -p /opt/hss-api/routes /opt/hss-api/utils
cp gce-backend/routes/epc-deployment.js /opt/hss-api/routes/epc-deployment.js 2>/dev/null || \
  cp backend-services/routes/epc-deployment.js /opt/hss-api/routes/epc-deployment.js
cp gce-backend/utils/deployment-helpers.js /opt/hss-api/utils/deployment-helpers.js

# Verify syntax
node -c /opt/hss-api/routes/epc-deployment.js
node -c /opt/hss-api/utils/deployment-helpers.js

# Restart service
systemctl daemon-reload
systemctl restart hss-api

# Verify service is running
sleep 3
systemctl status hss-api
```

**Option 2: Use the deployment script (if you have SSH key access):**

```bash
# Copy script to server first, then:
ssh root@136.112.111.167 'bash -s' < deploy-epc-dependencies.sh
```

**Option 3: Use Google Cloud Console SSH:**

1. Go to: https://console.cloud.google.com/compute/instances
2. Click on your GCE instance (acs-hss-server)
3. Click "SSH" button to open browser terminal
4. Run the commands from Option 1

### Verify Deployment:

```bash
# Check service status
systemctl status hss-api

# Test endpoint
curl -X POST http://localhost:3001/api/deploy/generate-epc-iso \
  -H 'Content-Type: application/json' \
  -H 'X-Tenant-ID: test' \
  -d '{"siteName":"Test Site","location":{},"networkConfig":{},"contact":{},"hssConfig":{}}'
```

## Frontend Deployment to Firebase

**Note:** No frontend code was changed in this update. The changes are only in backend EPC installation scripts. However, if you want to ensure everything is synced, you can deploy:

```bash
# From project root
npm run build

# Deploy to Firebase
firebase deploy --only hosting
```

Or deploy everything:

```bash
firebase deploy
```

## What Was Fixed

- **Preseed configuration** (ISO installation): Added `cmake` to package list (flex and bison were already present)
- **Deployment script** (post-install): Added `cmake flex bison` to dependency installation

These dependencies are now included in the automated EPC installation process generated by the ISO.

