# Cloud Build configuration for frontend deployment
# This builds and deploys the Module_Manager frontend to Firebase Hosting

steps:
  # Install frontend dependencies
  - name: 'node:20'
    dir: 'Module_Manager'
    entrypoint: 'npm'
    args: ['install']
    
  # Create .env file with backend server IP
  - name: 'ubuntu'
    dir: 'Module_Manager'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        cat > .env << 'EOF'
        # Backend Server Configuration
        PUBLIC_GENIEACS_NBI_URL=http://136.112.111.167:7557
        PUBLIC_GENIEACS_CWMP_URL=http://136.112.111.167:7547
        PUBLIC_GENIEACS_FS_URL=http://136.112.111.167:7567
        PUBLIC_GENIEACS_UI_URL=http://136.112.111.167:3333
        VITE_HSS_API_URL=http://136.112.111.167:3000
        PUBLIC_BACKEND_API_URL=http://136.112.111.167:3000/api
        VITE_FIREBASE_API_KEY=AIzaSyCaMoHY6ZKcV_uazY0HlwolxVgPwwLT8V0
        VITE_FIREBASE_AUTH_DOMAIN=lte-pci-mapper-65450042-bbf71.firebaseapp.com
        VITE_FIREBASE_PROJECT_ID=lte-pci-mapper-65450042-bbf71
        VITE_FIREBASE_STORAGE_BUCKET=lte-pci-mapper-65450042-bbf71.firebasestorage.app
        VITE_FIREBASE_MESSAGING_SENDER_ID=1044782186913
        VITE_FIREBASE_APP_ID=1:1044782186913:web:e1d47cdb7b1d89bb0b6f9c
        VITE_FIREBASE_MEASUREMENT_ID=
        EOF
        echo "âœ… Created .env file"
        cat .env
    
  # Build the frontend
  - name: 'node:20'
    dir: 'Module_Manager'
    entrypoint: 'npm'
    args: ['run', 'build']
    env:
      - 'NODE_ENV=production'
    
  # Deploy to Firebase Hosting
  - name: 'gcr.io/cloud-builders/gcloud'
    dir: 'Module_Manager'
    args:
      - 'firebase'
      - 'deploy'
      - '--only'
      - 'hosting'
      - '--project'
      - 'lte-pci-mapper-65450042-bbf71'

options:
  logging: CLOUD_LOGGING_ONLY
  machineType: 'N1_HIGHCPU_8'

timeout: '1800s'

