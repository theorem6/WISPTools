
<!DOCTYPE html>
<html>
<head>
    <title>Setup Admin Access</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f3f4f6;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #8b5cf6; margin-top: 0; }
        button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        button:hover { background: #7c3aed; }
        button:disabled { background: #9ca3af; cursor: not-allowed; }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .success { background: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .error { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
        .info { background: #e0e7ff; color: #3730a3; border-left: 4px solid #6366f1; }
        ul { line-height: 1.8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Setup Admin Access</h1>
        <p>Click the button below to set yourself as <strong>owner</strong> of all your tenants.</p>
        
        <p><strong>This will:</strong></p>
        <ul>
            <li>‚úÖ Grant you owner role in all your tenants</li>
            <li>‚úÖ Enable User Management module</li>
            <li>‚úÖ Enable Help Desk module</li>
            <li>‚úÖ Allow you to invite other users</li>
            <li>‚úÖ Give you full administrative access</li>
        </ul>
        
        <button id="setupBtn" onclick="setupAdmin()">Setup Admin Access</button>
        
        <div id="result"></div>
    </div>

    <script type="module">
        // Import Firebase Auth
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDdHjpIy0JnBG6fAkBv_Wdn6GNk95ph7_E",
            authDomain: "lte-pci-mapper-65450042-bbf71.firebaseapp.com",
            projectId: "lte-pci-mapper-65450042-bbf71",
            storageBucket: "lte-pci-mapper-65450042-bbf71.firebasestorage.app",
            messagingSenderId: "1044782186913",
            appId: "1:1044782186913:web:9e53a827ce6b76c3948be0"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        window.setupAdmin = async function() {
            const btn = document.getElementById('setupBtn');
            const resultDiv = document.getElementById('result');
            
            try {
                btn.disabled = true;
                btn.textContent = 'Checking authentication...';
                resultDiv.innerHTML = '';

                let user = auth.currentUser;
                
                // If not logged in, prompt login
                if (!user) {
                    resultDiv.innerHTML = '<div class="info">Please login with Google...</div>';
                    const provider = new GoogleAuthProvider();
                    const result = await signInWithPopup(auth, provider);
                    user = result.user;
                    resultDiv.innerHTML = '<div class="success">‚úÖ Logged in as: ' + user.email + '</div>';
                }

                // Get auth token
                const token = await user.getIdToken();
                
                // Call setupAdmin function
                btn.textContent = 'Setting up admin access...';
                resultDiv.innerHTML += '<div class="info">üîÑ Calling setupAdmin Cloud Function...</div>';

                const response = await fetch('https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/setupAdmin', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    let html = '<div class="success">';
                    html += '‚úÖ SUCCESS!\n\n';
                    html += data.message + '\n\n';
                    html += 'Your tenants:\n';
                    data.tenants.forEach(t => {
                        html += `  - ${t.tenantName}: ${t.status} (${t.role})\n`;
                    });
                    html += '\n';
                    html += 'Next steps:\n';
                    data.nextSteps.forEach(step => {
                        html += `  ‚úì ${step}\n`;
                    });
                    html += '</div>';
                    resultDiv.innerHTML = html;
                    btn.textContent = 'Setup Complete ‚úÖ';
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.error}\n${data.message || ''}</div>`;
                    btn.textContent = 'Setup Admin Access';
                    btn.disabled = false;
                }

            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
                btn.textContent = 'Setup Admin Access';
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>

