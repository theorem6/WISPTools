# tsconfig.json Fix - SvelteKit Extension Error

## ğŸ› The Error

```
Error: src/app.html does not exist
error during build:
Your tsconfig.json should extend the configuration generated by SvelteKit:
{
  "extends": "./.svelte-kit/tsconfig.json"
}
```

## ğŸ” Root Causes (2 Issues)

### Issue 1: Missing `extends` in tsconfig.json
The `tsconfig.json` file was missing the required `extends` field that SvelteKit needs.

### Issue 2: `.svelte-kit/tsconfig.json` Not Generated
The build process wasn't running `svelte-kit sync` which generates the `.svelte-kit/tsconfig.json` file.

## âœ… Fixes Applied

### Fix 1: Updated tsconfig.json

**Before:**
```json
{
  "compilerOptions": {
    ...
  },
  "include": ["src/**/*.ts", "src/**/*.svelte"],
  "exclude": ["node_modules", "build", ".svelte-kit"]
}
```

**After:**
```json
{
  "extends": "./.svelte-kit/tsconfig.json",  â† Added this!
  "compilerOptions": {
    ...
  },
  "include": ["src/**/*.ts", "src/**/*.svelte"],
  "exclude": ["node_modules", "build", ".svelte-kit"]
}
```

### Fix 2: Updated Build Commands

All `apphosting.yaml` files now run `svelte-kit sync` before building:

**Before:**
```yaml
buildCommand: npm install && NODE_OPTIONS="--max-old-space-size=6144" npm run build
```

**After:**
```yaml
buildCommand: npm install && npx svelte-kit sync && NODE_OPTIONS="--max-old-space-size=6144" npm run build
```

## ğŸ“‹ Files Modified

| File | Change | Reason |
|------|--------|--------|
| `Module_Manager/tsconfig.json` | Added `"extends": "./.svelte-kit/tsconfig.json"` | Required by SvelteKit |
| `apphosting.yaml` | Added `npx svelte-kit sync` to build | Generate required config |
| `Module_Manager/apphosting.yaml` | Added `npx svelte-kit sync` to build | Generate required config |
| `Module_Manager/apphosting.yaml.gce-backend` | Added `npx svelte-kit sync` to build | Generate required config |
| `Module_Manager/test-build.sh` | Created | Test builds locally |

## ğŸ§ª Test Locally

Before deploying, test the build locally:

```bash
cd Module_Manager
chmod +x test-build.sh
./test-build.sh
```

Expected output:
```
âœ… src/app.html exists
âœ… .svelte-kit/tsconfig.json generated
âœ… build/index.js created
âœ… build/client directory created
âœ… Build test successful!
```

## ğŸš€ Deploy Now

With these fixes, your deployment should work:

```bash
cd PCI_mapper
firebase deploy --only apphosting
```

## ğŸ“Š Build Process (Correct Order)

```
1. npm install
   â†“
2. npx svelte-kit sync    â† Generates .svelte-kit/tsconfig.json
   â†“
3. TypeScript reads tsconfig.json
   â†“
4. tsconfig.json extends .svelte-kit/tsconfig.json  â† Now exists!
   â†“
5. Vite build runs
   â†“
6. Looks for src/app.html   â† In correct directory!
   â†“
7. Build succeeds âœ…
```

## ğŸ” Why This Is Required

SvelteKit uses a **two-phase configuration** system:

1. **Phase 1: Sync** (`svelte-kit sync`)
   - Generates `.svelte-kit/` directory
   - Creates `.svelte-kit/tsconfig.json` with SvelteKit-specific settings
   - Creates `.svelte-kit/types/` for type definitions

2. **Phase 2: Build** (`vite build`)
   - Your `tsconfig.json` extends the generated config
   - TypeScript compilation with correct settings
   - Vite bundles everything

Without running `sync` first, the extended config doesn't exist, causing the error.

## ğŸ’¡ Additional Notes

### SvelteKit Sync
The `svelte-kit sync` command:
- Must run before building
- Must run after `npm install`
- Generates type definitions for routes
- Creates the base TypeScript configuration

### Why It Wasn't Failing Before
You might have run `npm run dev` locally, which automatically runs `svelte-kit sync`. But in CI/CD (Firebase), only the explicit build command runs.

## ğŸ¯ Summary of All Fixes

We've now fixed **THREE issues** for frontend deployment:

1. âœ… **Missing `rootDirectory`** - Fixed in previous update
2. âœ… **Missing `extends` in tsconfig.json** - Fixed now
3. âœ… **Missing `svelte-kit sync` in build** - Fixed now

## ğŸ§ª Verification Checklist

Before deploying:
- [ ] `Module_Manager/src/app.html` exists
- [ ] `Module_Manager/tsconfig.json` has `extends` field
- [ ] `apphosting.yaml` has `rootDirectory: Module_Manager`
- [ ] Build command includes `npx svelte-kit sync`
- [ ] Local test build succeeds (`./test-build.sh`)

After deploying:
- [ ] Build logs show no errors
- [ ] Application starts on port 8080
- [ ] Health check passes
- [ ] Frontend loads in browser

## ğŸ‰ Ready to Deploy!

All configuration issues are now resolved:

```bash
# Test locally first (recommended)
cd Module_Manager
./test-build.sh

# If test passes, deploy!
cd ..
firebase deploy --only apphosting
```

---

**Status**: âœ… FIXED  
**Issues Resolved**: 3  
**Confidence**: High - These are the standard SvelteKit requirements  
**Next Step**: Deploy and test

