# Firebase App Hosting Configuration - Default (Production)
# This is the base configuration that applies to all environments
# Environment-specific overrides go in apphosting.[environment].yaml
# Updated: 2025-10-17 - Added Remote EPCs and Distributed EPC Monitoring

# Root directory where the app code is located
rootDirectory: Module_Manager

# Build and run commands
# Using 6GB heap for build to handle ArcGIS + Firebase + SvelteKit bundling
buildCommand: npm install && npx svelte-kit sync && NODE_OPTIONS="--max-old-space-size=6144" npm run build && ls -lh build/client/_app/immutable/entry/ || echo "⚠️  Build directory check failed"
runCommand: node server.js

runConfig:
  # Optimized for SvelteKit + ArcGIS
  cpu: 1                # 1 CPU is sufficient for most web apps
  memoryMiB: 2048       # 2 GB - needed for ArcGIS and startup stability
  minInstances: 0       # Scale to zero when idle (saves cost during dev/testing)
  maxInstances: 5       # Sufficient for initial deployment
  concurrency: 80       # Standard concurrency per instance

env:
  # ==========================================
  # FIREBASE CONFIGURATION
  # ==========================================
  - variable: PUBLIC_FIREBASE_API_KEY
    value: "AIzaSyCaMoHY6ZKcV_uazY0HlwolxVgPwwLT8V0"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_FIREBASE_AUTH_DOMAIN
    value: "lte-pci-mapper-65450042-bbf71.firebaseapp.com"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_FIREBASE_PROJECT_ID
    value: "lte-pci-mapper-65450042-bbf71"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_FIREBASE_STORAGE_BUCKET
    value: "lte-pci-mapper-65450042-bbf71.firebasestorage.app"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    value: "1044782186913"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_FIREBASE_APP_ID
    value: "1:1044782186913:web:a5367441ce136118948be0"
    availability:
      - BUILD
      - RUNTIME

  # ==========================================
  # FIREBASE FUNCTIONS API ENDPOINTS
  # ==========================================
  - variable: PUBLIC_FIREBASE_FUNCTIONS_REGION
    value: "us-central1"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_FIREBASE_FUNCTIONS_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net"
    availability:
      - BUILD
      - RUNTIME

  # GenieACS Integration API Endpoints
  - variable: PUBLIC_GENIEACS_NBI_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/genieacsNBI"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_GENIEACS_CWMP_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/genieacsCWMP"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_GENIEACS_FS_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/genieacsFS"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_SYNC_CPE_DEVICES_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/syncCPEDevices"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_GET_CPE_DEVICES_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/getCPEDevices"
    availability:
      - BUILD
      - RUNTIME

  # PCI Analysis API
  - variable: PUBLIC_PCI_ANALYSIS_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/analyzePCI"
    availability:
      - BUILD
      - RUNTIME

  # MongoDB-backed Presets Management
  - variable: PUBLIC_GET_MONGO_PRESETS_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/getMongoPresets"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_CREATE_MONGO_PRESET_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/createMongoPreset"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_UPDATE_MONGO_PRESET_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/updateMongoPreset"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_DELETE_MONGO_PRESET_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/deleteMongoPreset"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_TOGGLE_MONGO_PRESET_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/toggleMongoPreset"
    availability:
      - BUILD
      - RUNTIME

  # MongoDB-backed Faults Management
  - variable: PUBLIC_GET_MONGO_FAULTS_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/getMongoFaults"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_ACKNOWLEDGE_MONGO_FAULT_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/acknowledgeMongoFault"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_DELETE_MONGO_FAULT_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/deleteMongoFault"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_CREATE_MONGO_FAULT_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/createMongoFault"
    availability:
      - BUILD
      - RUNTIME

  # ==========================================
  # ARCGIS CONFIGURATION
  # ==========================================
  - variable: PUBLIC_ARCGIS_API_KEY
    value: "AAPT85fOqywZsicJupSmVSCGrjWNNjURUpnE--wnh6GZUreHU00VSEoRGgbf0JZjKYEmLnUXJw8E5r8Nz55eqYvvfcecdjs2BjpjcShOZgei0o-Myxttbl5f1qu9-AfdJaw4w3ugB4-uH6dh9v0PNN--vklICR-vCwt8YjMxw7CBrsZ5vxsZjo_jp31mV5hlMSSxQMJsKtFh0ltDrN4YwuK_8ZLmHMdIp5w9_jZrqJVlC2I.AT2_12sjSDHZ"
    availability:
      - BUILD
      - RUNTIME

  # ==========================================
  # GOOGLE OAUTH CONFIGURATION (for CBRS/Google SAS)
  # ==========================================
  # Create OAuth Client ID in Google Cloud Console:
  # https://console.cloud.google.com/apis/credentials?project=lte-pci-mapper-65450042-bbf71
  # Type: Web application
  # Authorized origins: https://lte-pci-mapper--lte-pci-mapper-65450042-bbf71.us-east4.hosted.app
  # Redirect URIs: https://lte-pci-mapper--lte-pci-mapper-65450042-bbf71.us-east4.hosted.app/oauth/google/callback
  - variable: PUBLIC_GOOGLE_OAUTH_CLIENT_ID
    value: "1044782186913-kehquaq56fcubedupb34611c0hm1ctob.apps.googleusercontent.com"
    availability:
      - BUILD
      - RUNTIME

  # ==========================================
  # CBRS / GOOGLE SAS PLATFORM CONFIGURATION (Admin Only)
  # ==========================================
  # These are stored in Firestore by platform admin
  # Configure via: Tenant Management → CBRS Platform Keys
  # Collection: cbrs_platform_config/platform
  # 
  # The platform Google SAS API key is managed through the admin UI
  # and stored encrypted in Firestore, not as an environment variable
  # This comment is for documentation only

  # ==========================================
  # AI SERVICES CONFIGURATION
  # ==========================================
  - variable: PUBLIC_GEMINI_API_KEY
    value: "AIzaSyAVBmH_eC98f6GCIpHZJ8B_y40TuoIjXOg"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_WOLFRAM_APP_ID
    value: "WQPAJ72446"
    availability:
      - BUILD
      - RUNTIME

  # ==========================================
  # MONGODB CONFIGURATION (for GenieACS)
  # ==========================================
  # MongoDB Atlas connection using official Node.js driver v6.x
  # Reference: https://www.mongodb.com/docs/drivers/node/current/
  
  # Production MongoDB connection string
  # Replace <db_password> with your actual password
  - variable: MONGODB_URI
    value: "mongodb+srv://genieacs-user:<db_password>@cluster0.1radgkw.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0"
    availability:
      - RUNTIME

  - variable: MONGODB_DATABASE
    value: "genieacs"
    availability:
      - RUNTIME

  # ==========================================
  # GENIEACS CONFIGURATION
  # ==========================================
  - variable: GENIEACS_ENABLE_FIRESTORE_SYNC
    value: "true"
    availability:
      - RUNTIME

  - variable: GENIEACS_SYNC_INTERVAL
    value: "300000"  # 5 minutes in milliseconds
    availability:
      - RUNTIME

  - variable: GENIEACS_CWMP_PORT
    value: "7547"
    availability:
      - RUNTIME

  # ==========================================
  # APPLICATION CONFIGURATION
  # ==========================================
  - variable: NODE_ENV
    value: "production"
    availability:
      - BUILD
      - RUNTIME

  - variable: PORT
    value: "8080"
    availability:
      - RUNTIME

  - variable: PUBLIC_APP_URL
    value: "https://lte-pci-mapper-65450042-bbf71.web.app"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_API_TIMEOUT
    value: "30000"  # 30 seconds
    availability:
      - BUILD
      - RUNTIME

  # ==========================================
  # CORS CONFIGURATION
  # ==========================================
  - variable: ALLOWED_ORIGINS
    value: "https://lte-pci-mapper-65450042-bbf71.web.app,https://lte-pci-mapper-65450042-bbf71.firebaseapp.com"
    availability:
      - RUNTIME

  # ==========================================
  # GCE BACKEND CONFIGURATION
  # Backend Server: 136.112.111.167 (acs-h)
  # Using Firebase Functions proxy for HTTPS
  # ==========================================
  - variable: PUBLIC_BACKEND_API_URL
    value: "http://136.112.111.167:3000/api"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_GENIEACS_NBI_URL
    value: "http://136.112.111.167:7557"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_GENIEACS_CWMP_URL
    value: "http://136.112.111.167:7547"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_GENIEACS_FS_URL
    value: "http://136.112.111.167:7567"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: PUBLIC_GENIEACS_UI_URL
    value: "http://136.112.111.167:3333"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: VITE_HSS_API_URL
    value: "https://us-central1-lte-pci-mapper-65450042-bbf71.cloudfunctions.net/hssProxy"
    availability:
      - BUILD
      - RUNTIME

  - variable: PUBLIC_STUN_SERVER
    value: "stun:136.112.111.167:3478"
    availability:
      - BUILD
      - RUNTIME